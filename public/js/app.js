"use strict";function Auth(e,t){e.loginUrl=t+"/login",e.signupUrl=t+"/register",e.tokenPrefix=""}function RegisterController(e,t){function o(){e.signup(r.user).then(function(){t.go("home")})}var r=this;r.user={},r.submit=o}function LoginController(e,t){function o(){e.login(l.credentials).then(function(){t.go("userProfile")})}function r(t){e.authenticate(t).then(function(e){console.log(e)})}var l=this;l.credentials={},l.submit=o,l.authenticate=r}function googleMap(e){return{restrict:"E",replace:!0,template:'<div class="google-map"></div>',scope:{spaces:"="},link:function(t,o){function r(){n.forEach(function(e){e.setMap(null)}),n=[]}var l=new e.google.maps.Map(o[0],{center:{lat:51.50853,lng:-.076132},zoom:9,scrollwheel:!1}),n=[],a=null;t.$watch("spaces",function(){r(),t.spaces.$resolved&&t.spaces.forEach(function(t){t.lat&&t.lng&&!function(){var o=new e.google.maps.Marker({position:{lat:t.lat,lng:t.lng},map:l,animation:e.google.maps.Animation.DROP});o.addListener("click",function(){a&&a.close();var r='\n                <p>Contact: <a href="mailto:'+t.user.email+'?subject=Query about your parking space">'+t.user.email+"</a></p>\n                <p>"+t.details+"</p>\n                <img src="+t.image+">";a=new e.google.maps.InfoWindow({content:r}),a.open(l,o),n.push(o)})}()})},!0)}}}function googleplace(e){return{restrict:"A",require:"ngModel",scope:{spaces:"="},link:function(t,o,r,l){var n={types:[],componentRestrictions:{}},a=new e.google.maps.places.Autocomplete(o[0],n);a.addListener("place_changed",function(){var e=a.getPlace(),r=e.geometry.location.toJSON();t.spaces.lat=r.lat,t.spaces.lng=r.lng,console.log(e),l.$setViewValue(o.val())})}}}function MainController(e,t,o){function r(){e.logout().then(function(){t.go("home")})}function l(o,r,l,i){n.message=null,n.containerClass="spacesIndex"!==r.name,e.isAuthenticated()&&"spacesIndex"===s&&"userProfile"===r.name&&(o.preventDefault(),t.go(s),s=null),e.isAuthenticated()||a.includes(r.name)||("home"===i.name&&(s=r.name),o.preventDefault(),t.go("login"),n.message="You must be logged in to go there!")}var n=this;n.isLoggedIn=e.isAuthenticated,n.message=null;var a=["home","register","login"],s=null;o.$on("$stateChangeStart",l),n.logout=r}function Router(e,t){e.state("home",{url:"/",templateUrl:"/templates/landingPage.html"}).state("userProfile",{url:"/profile",templateUrl:"/templates/userProfile.html",controller:"UserProfileController as userProfile"}).state("usersEdit",{url:"/profile/edit",templateUrl:"/templates/userEdit.html",controller:"UserEditController as userEdit"}).state("register",{url:"/register",templateUrl:"/templates/register.html",controller:"RegisterController as register"}).state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"LoginController as login"}).state("spacesIndex",{url:"/spaces",templateUrl:"/templates/spacesIndex.html",controller:"SpacesIndexController as spacesIndex"}).state("spacesAdd",{url:"/spaces/add",templateUrl:"/templates/spacesAdd.html",controller:"SpacesNewController as spacesNew"}).state("spacesEdit",{url:"/spaces/:id/edit",templateUrl:"/templates/spacesEdit.html",controller:"SpacesEditController as spacesEdit"}).state("spacesShow",{url:"/spaces/show",templateUrl:"/templates/spacesShow.html",controller:"SpacesShowController as spacesShow"}),t.otherwise("/")}function Space(e,t){return new e(t+"/spaces/:id",{id:"@id"},{update:{method:"PUT"}})}function SpacesIndexController(e){var t=this;t.all=e.query()}function SpacesNewController(e,t,o){function r(){e.save(l.spaces,function(){t.go("spacesIndex")})}var l=this;l.spaces={},l.spaces.user_id=o.getPayload().id,l.create=r}function SpacesShowController(e,t,o,r){function l(t){e.remove({id:t.id},function(){o.go("spacesIndex")})}var n=this;n.user=t.get({id:r.getPayload().id}),n.delete=l,n.isLoggedIn=r.isAuthenticated}function SpacesEditController(e,t){function o(){r.space.$update(function(){t.go("spacesIndex")})}var r=this;r.space=e.get(t.params),this.update=o}function User(e,t){return new e(t+"/users/:id",{id:"@id"},{update:{method:"PUT"}})}function UserProfileController(e,t,o){function r(){l.user.$remove(function(){t.go("home")})}var l=this;l.user=e.get({id:o.getPayload().id}),l.delete=r,l.isLoggedIn=o.isAuthenticated}function UserEditController(e,t,o){function r(){l.user.$update(function(){t.go("userProfile",t.params)})}var l=this;l.user=e.get({id:o.getPayload().id}),this.update=r}angular.module("finalProject",["ngResource","ui.router","satellizer"]).constant("API_URL","http://localhost:3000/api").config(Auth),Auth.$inject=["$authProvider","API_URL"],angular.module("finalProject").controller("RegisterController",RegisterController).controller("LoginController",LoginController),RegisterController.$inject=["$auth","$state"],LoginController.$inject=["$auth","$state"],angular.module("finalProject").directive("googleMap",googleMap).directive("googleplace",googleplace),googleMap.$inject=["$window"],googleplace.$inject=["$window"],angular.module("finalProject").controller("MainController",MainController),MainController.$inject=["$auth","$state","$rootScope"],angular.module("finalProject").config(Router),Router.$inject=["$stateProvider","$urlRouterProvider"],angular.module("finalProject").factory("Space",Space),Space.$inject=["$resource","API_URL"],angular.module("finalProject").controller("SpacesIndexController",SpacesIndexController).controller("SpacesNewController",SpacesNewController).controller("SpacesShowController",SpacesShowController).controller("SpacesEditController",SpacesEditController),SpacesIndexController.$inject=["Space"],SpacesNewController.$inject=["Space","$state","$auth"],SpacesShowController.$inject=["Space","User","$state","$auth"],SpacesEditController.$inject=["Space","$state"],angular.module("finalProject").factory("User",User),User.$inject=["$resource","API_URL"],angular.module("finalProject").controller("UserProfileController",UserProfileController).controller("UserEditController",UserEditController),UserProfileController.$inject=["User","$state","$auth"],UserEditController.$inject=["User","$state","$auth"];
//# sourceMappingURL=app.js.map
